name: React App CI + Cypress E2E

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ”„ Checkout Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
      uses: actions/checkout@v3

    - name: ğŸŸ¢ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 18

    - name: ğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
      run: npm ci

    - name: ğŸ› ï¸ Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
      run: npm run build

    - name: ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ dev-ÑĞµÑ€Ğ²ĞµÑ€
      run: npm start &
      env:
        CI: false

    - name: ğŸ•’ ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°
      run: npx wait-on http://localhost:3000

    - name: ğŸ§ª Ğ—Ğ°Ğ¿ÑƒÑĞº Cypress E2E Ñ‚ĞµÑÑ‚Ğ¾Ğ²
      uses: cypress-io/github-action@v6
      with:
        start: npm start
        wait-on: 'http://localhost:3000'
        wait-on-timeout: 60
        browser: chrome
